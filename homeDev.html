<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	</head>
	<body>
		<form name="logForm">
			Login :<input type="text" name="login" id="login"> <br>
			Password :<input type="password" name="password" id="password"> <br>
			<button type="button" id="btn-token"> Token </button>
			<button type="button" id="btn-auth"> Authenticate </button> <br>

			Create game name :<input type="text" name="game_name" id="game_name"> <br>
			Number of players :<input type="number" name="number_players" id="number_players" min="5" max="10"> <br>
			<button type="button" id="btn-create_game"> Create </button> <br>
			<button type="button" id="btn-list_game"> List </button> <br>
			<button type="button" id="btn-show_game"> Show </button> <br>
			<div id="dropdown">
				<select name="drop-down-list" id="drop-down-list"></select>
			</div>
			Join a game :<input type="text" name="join_game" id="join_game">
			<button type="button" id="btn-create_game"> Search  </button>
		</form>
		<div id="welcome"><p>Welcome !</p></div>
		<div id="test"><p>Test</p></div>
		
		
		
		<!-- Documentation github.com/elwinar/the-resistance   -->
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
		<script> 
		
			var cfg = {
				domain: "http://ogg.elwinar.com:56789",
			};

			var state = {
				token: '',
			};
			
			var game = {
				id: '',
				players: '',
				created_at: '',
				started_at: '',
				finished_at: '',
				name: '',
				joined:''
			}
			
			var player = {
				login: '',
				password: ''
			}
			
			$(document).ready(function() {
				console.log( "ready!" );
			});

			
			//Get token from server then authenticate
			$('#btn-token').on("click", function getToken() {
				player.login = $('#login').val();
				player.password = $('#password').val();
				var payload = {
					"login" : player.login,
					"password" : player.password
				};
				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: cfg.domain + '/login',
					data: JSON.stringify(payload),
					success: function(data) {
						state.token = data.token;
						console.log("Your token : " + state.token);
						authentication();
					},
				}); 
			});
					
			//Authentication
			function authentication() {
				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: cfg.domain + '/authenticate',
					headers: {
						'token': state.token,
					},
					success: function(data) {
						if(data.authenticated) {
							console.log(player.login + " is authenticated");
						} else {
							console.log("Error authentication");
						}
						$('#welcome').text("Welcome " + player.login + " !");
					},
				}); 
			}
			
			//List all games
			$('#btn-list_game').on("click", function getListGames() {
				$('#dropdown select').empty();
				$.ajax({
					type: 'GET',
					dataType: 'json',
					url: cfg.domain + '/game',
					headers: {
						'token': state.token,
					},
					success: function(data) {
						var game = [];
						for(var i = 0; i < data.length; i++) {
							game.push({ 
								id: data[i].id, 
								name: data[i].name,
								players: data[i].players, 
								created_at: data[i].created_at, 
								started_at: data[i].started_at, 
								finished_at: data[i].finished_at,
								joined: data[i].joined
							});
							$('#dropdown select').append('<option value=' + data[i].id + '>' + data[i].name + '</option>');
							console.log(game[i].id + game[i].players + game[i].created_at + game[i].started_at + game[i].finished_at + game[i].name + game[i].joined)
						}
					},
				});
			});
			

			
			//Show a game by ID
			$('#btn-show_game').on("click", function showGame() {
				$.ajax({
					type: 'GET',
					dataType: 'json',
					url: cfg.domain + '/game/1',
					headers: {
						'token': state.token,
					},
					success: function(data) {
						$('#test').text(data.id);
					},
				}); 
			});
			
			//Create a game
			$('#btn-create_game').on("click", function createGame() {
				var new_game_name = $('#game_name').val();
				var number_players = $('#number_players').val();
				var payload = {
					"name": new_game_name,
					"players": parseInt(number_players)
				};

				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: cfg.domain + '/game',
					data: JSON.stringify(payload),
					headers: {
						'token': state.token,
					},
					success: function(data) {
						console.log(new_game_name + " game created");
					},
				}); 
			});			
			
			
			/*
			$('#btn-search_game').on("click", function searchGameByName() {
				var searched_name = $('#searched_name_game').val();
				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: cfg.domain + '/game',
					headers: {
						'token': state.token,
					},
					success: function(data) {
						for(var i = 0; i < data.length; i++) {
							if (data[i].name === searched_name) {
								console.log("Game " + data[i].name + " found with ID : " + game.id)
							} else {
								console.log("No game found")
							}
						}
					},
				}); 
			});			
			
			
			$("#butt").onclick function(eu)
					$(window).fire('page_change' $(eu.target).attr[href])
			*/
		</script>
	</body>
</html>